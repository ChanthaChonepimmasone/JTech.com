<!DOCTYPE html>
<html lang="lo">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lao Karaoke - ‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤‡ªÇ‡∫≠‡ªÄ‡∫Å‡∫∞</title>
  
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <style>
    /* ‡∫ï‡∫ª‡∫ö‡ªÅ‡∫ï‡ªà‡∫á UI ‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡ªÄ‡∫ï‡∫µ‡∫°‡∫à‡∫≤‡∫Å‡ªÑ‡∫ü‡∫•‡ªå‡ªÄ‡∫î‡∫µ‡∫° */
    :root {
      --primary-color: #2c5282;
      --primary-light: #4299e1;
      --secondary-color: #38a169;
      --light-bg: #f7fafc;
      --border-color: #e2e8f0;
      --text-color: #2d3748;
      --white: #ffffff;
    }

    body { font-family: 'Saysettha OT', sans-serif; background: var(--light-bg); margin: 0; }

    /* Login Overlay */
    .auth-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); display: flex; justify-content: center;
      align-items: center; z-index: 2000;
    }
    .auth-box { background: white; padding: 30px; border-radius: 12px; text-align: center; }

    .user-bar {
      background: white; padding: 10px 20px; border-bottom: 1px solid var(--border-color);
      display: flex; justify-content: space-between; align-items: center;
    }

    .container { max-width: 800px; margin: 0 auto; padding: 20px; }
    textarea { width: 100%; height: 150px; padding: 15px; border-radius: 8px; border: 1px solid var(--border-color); margin-bottom: 15px; }
    
    .btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
    .btn-primary { background: var(--primary-color); color: white; width: 100%; }
    .btn-success { background: var(--secondary-color); color: white; }
    
    .hidden { display: none !important; }
    .output-box { background: white; padding: 15px; border: 1px solid var(--border-color); min-height: 100px; border-radius: 8px; margin-top: 15px; }
  </style>
</head>
<body>

  <div id="authOverlay" class="auth-overlay">
    <div class="auth-box">
      <h2>‡∫ç‡∫¥‡∫ô‡∫î‡∫µ‡∫ï‡ªâ‡∫≠‡∫ô‡∫Æ‡∫±‡∫ö</h2>
      <p>‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫™‡∫π‡ªà‡∫•‡∫∞‡∫ö‡∫ª‡∫ö‡∫î‡ªâ‡∫ß‡∫ç Google ‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÉ‡∫ä‡ªâ‡∫á‡∫≤‡∫ô</p>
      <button id="googleLoginBtn" class="btn btn-primary">Login with Google</button>
    </div>
  </div>

  <div id="userBar" class="user-bar hidden">
    <div id="userName">‡∫Å‡∫≥‡∫•‡∫±‡∫á‡ªÇ‡∫´‡∫º‡∫î...</div>
    <div id="usageQuota" style="font-weight: bold;">‡ªÇ‡∫Ñ‡∫ï‡ªâ‡∫≤: 0/15</div>
    <button id="logoutBtn" style="color:red; background:none; border:none; cursor:pointer;">Logout</button>
  </div>

  <div class="container">
    <h1 style="text-align:center; color: var(--primary-color);">‡ªÅ‡∫õ‡∫•‡∫≤‡∫ß ‚Üî Karaoke</h1>
    
    <textarea id="inputText" placeholder="‡∫û‡∫¥‡∫°‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°‡∫ó‡∫µ‡ªà‡∫ô‡∫µ‡ªâ..."></textarea>
    
    <select id="direction" style="width:100%; padding:10px; margin-bottom:15px;">
      <option value="lao-to-karaoke">‡∫•‡∫≤‡∫ß ‚ûú Karaoke</option>
      <option value="karaoke-to-lao">Karaoke ‚ûú ‡∫•‡∫≤‡∫ß</option>
    </select>

    <div style="display:flex; gap:10px;">
      <button id="translateBtn" class="btn btn-primary" style="flex:1;">‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤</button>
      <button id="clearBtn" class="btn" style="background:#ddd;">‡∫•‡ªâ‡∫≤‡∫á</button>
    </div>

    <div id="output" class="output-box"></div>

    <div id="premiumSection" style="margin-top:30px; border:2px solid #ecc94b; padding:20px; text-align:center; border-radius:10px;">
      <h3>‚≠ê ‡∫õ‡∫ª‡∫î‡∫•‡∫±‡∫≠‡∫Å Premium (‡∫ö‡ªç‡ªà‡∫à‡∫≥‡∫Å‡∫±‡∫î)</h3>
      <p>‡∫ä‡∫≥‡∫•‡∫∞‡∫ú‡ªà‡∫≤‡∫ô BCEL One ‡ªÅ‡∫•‡ªâ‡∫ß‡∫™‡∫ª‡ªà‡∫á‡ªÉ‡∫ö‡∫ö‡∫¥‡∫ô‡∫°‡∫≤‡∫ó‡∫≤‡∫á WhatsApp</p>
      <a href="https://wa.me/2029988148" target="_blank" class="btn btn-success" style="text-decoration:none; display:inline-block; background:#ecc94b; color:black;">
        ‡∫™‡∫∞‡ªù‡∫±‡∫Å‡∫ó‡∫µ‡ªà‡∫ô‡∫µ‡ªâ
      </a>
    </div>
  </div>

  <script>
    // --- 2. Firebase Configuration (‡ªÉ‡∫ä‡ªâ‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫ó‡∫µ‡ªà‡∫ó‡ªà‡∫≤‡∫ô‡ªÉ‡∫´‡ªâ‡∫°‡∫≤) ---
    const firebaseConfig = {
      apiKey: "AIzaSyAQDV_jzYvaAR7EzbUclP5ru-rMygMW44I",
      authDomain: "laokaraoke-43d77.firebaseapp.com",
      projectId: "laokaraoke-43d77",
      storageBucket: "laokaraoke-43d77.firebasestorage.app",
      messagingSenderId: "6060211155",
      appId: "1:6060211155:web:f5a63c55cf6e0ea9180d26",
      measurementId: "G-RYHD1BZ16B"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;
    let userData = { usageCount: 0, isPremium: false };

    // --- 3. Logic ‡∫Å‡∫≤‡∫ô Login ---
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        currentUser = user;
        document.getElementById('authOverlay').classList.add('hidden');
        document.getElementById('userBar').classList.remove('hidden');
        document.getElementById('userName').textContent = user.displayName;
        await syncUserData(user.uid);
      } else {
        document.getElementById('authOverlay').classList.remove('hidden');
        document.getElementById('userBar').classList.add('hidden');
      }
    });

    async function syncUserData(uid) {
      const userRef = db.collection('users').doc(uid);
      const doc = await userRef.get();
      const today = new Date().toDateString();

      if (!doc.exists) {
        userData = { usageCount: 0, isPremium: false, lastReset: today };
        await userRef.set(userData);
      } else {
        userData = doc.data();
        if (userData.lastReset !== today && !userData.isPremium) {
          userData.usageCount = 0;
          userData.lastReset = today;
          await userRef.update({ usageCount: 0, lastReset: today });
        }
      }
      updateUI();
    }

    function updateUI() {
      const qLabel = document.getElementById('usageQuota');
      if (userData.isPremium) {
        qLabel.innerHTML = "‚≠ê Premium ‡∫ö‡ªç‡ªà‡∫à‡∫≥‡∫Å‡∫±‡∫î";
        document.getElementById('premiumSection').classList.add('hidden');
      } else {
        qLabel.textContent = `‡ªÇ‡ªÇ‡∫Ñ‡∫ï‡ªâ‡∫≤: ${userData.usageCount}/15`;
      }
    }

    // --- 4. Logic ‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤ (‡∫à‡∫≤‡∫Å Code ‡ªÄ‡∫î‡∫µ‡∫°‡∫Ç‡∫≠‡∫á‡∫ó‡ªà‡∫≤‡∫ô) ---
    const dictionary = { "‡∫ä‡ªç‡ªà‡∫≤": "sam", "‡ªÄ‡∫ö‡∫µ‡∫á": "bg", "‡∫´‡∫°‡∫≤": "Marüê∂", "‡ªù‡∫≤": "Marüê∂" };

    async function handleTranslate() {
      if (!userData.isPremium && userData.usageCount >= 15) {
        alert("‡ªÇ‡ªÇ‡∫Ñ‡∫ï‡ªâ‡∫≤‡ªù‡∫ª‡∫î‡ªÅ‡∫•‡ªâ‡∫ß! ‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡∫™‡∫∞‡ªù‡∫±‡∫Å Premium");
        return;
      }

      const input = document.getElementById('inputText').value.trim();
      if (!input) return;

      // ‡∫™‡∫ª‡∫°‡∫°‡∫∏‡∫î‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ (Logic ‡ªÄ‡∫î‡∫µ‡∫°)
      let result = input; 
      // ... (‡ªÉ‡∫™‡ªà Logic dictionary.replace ‡∫ó‡∫µ‡ªà‡∫ô‡∫µ‡ªâ)

      document.getElementById('output').textContent = "‡∫ú‡∫ª‡∫ô‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ: " + result;

      if (!userData.isPremium) {
        userData.usageCount++;
        updateUI();
        await db.collection('users').doc(currentUser.uid).update({ usageCount: userData.usageCount });
      }
    }

    // Event Listeners
    document.getElementById('googleLoginBtn').onclick = () => auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
    document.getElementById('logoutBtn').onclick = () => auth.signOut();
    document.getElementById('translateBtn').onclick = handleTranslate;
    document.getElementById('clearBtn').onclick = () => {
      document.getElementById('inputText').value = '';
      document.getElementById('output').textContent = '';
    };
  </script>
</body>
</html>
