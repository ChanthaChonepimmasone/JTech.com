<!DOCTYPE html>
<html lang="lo">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lao Karaoke - Premium Translator</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --primary: #2c5282;
            --success: #38a169;
            --warning: #ecc94b;
            --danger: #e53e3e;
            --bg: #f7fafc;
            --card: #ffffff;
            --text: #2d3748;
            --text-secondary: #718096;
        }

        body { font-family: 'Saysettha OT', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 70px; }
        .hidden { display: none !important; }

        /* Navigation Bottom Bar */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; border-top: 1px solid #e2e8f0; height: 65px; z-index: 1000; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; color: var(--text-secondary); }
        .nav-item.active { color: var(--primary); }
        .nav-item small { font-size: 10px; margin-top: 4px; }

        /* Components */
        .container { max-width: 500px; margin: 0 auto; padding: 20px; }
        .card { background: var(--card); border-radius: 16px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .btn { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-google { background: white; border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; gap: 10px; }

        /* Profile & Premium */
        .profile-img { width: 90px; height: 90px; border-radius: 50%; border: 4px solid var(--primary); margin: 0 auto 15px; display: block; }
        .premium-tag { background: var(--warning); padding: 5px 15px; border-radius: 20px; font-size: 12px; font-weight: bold; color: black; display: inline-block; }
        .qr-box { background: white; padding: 15px; border-radius: 12px; border: 2px dashed #cbd5e0; margin: 20px 0; text-align: center; }

        /* Translator Styles */
        textarea { width: 100%; height: 150px; border: 1px solid #e2e8f0; border-radius: 12px; padding: 15px; font-size: 16px; box-sizing: border-box; resize: none; }
        .output-container { background: #edf2f7; padding: 15px; border-radius: 12px; min-height: 50px; font-weight: 500; color: var(--primary); position: relative; }
    </style>
</head>
<body>

    <div id="page-login" class="auth-overlay" style="height: 100vh; display: flex; align-items: center; justify-content: center; background: var(--bg);">
        <div class="card" style="width: 85%; text-align: center;">
            <div style="font-size: 40px; margin-bottom: 10px;">üéôÔ∏è</div>
            <h2 style="margin-bottom: 5px;">‡∫™‡∫∞‡∫ö‡∫≤‡∫ç‡∫î‡∫µ!</h2>
            <p style="color: var(--text-secondary); margin-bottom: 30px;">‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫™‡∫π‡ªà‡∫•‡∫∞‡∫ö‡∫ª‡∫ö‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÄ‡∫•‡∫µ‡ªà‡∫°‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤</p>
            <button id="btn-login-google" class="btn btn-google">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
                Login with Google
            </button>
        </div>
    </div>

    <div id="app-content" class="hidden">
        <div class="container">
            
            <div id="tab-translate" class="tab-view">
                <h2 style="margin-bottom: 20px;">‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤</h2>
                <div class="card">
                    <div style="display:flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; font-weight: bold;">
                        <span id="label-from">‡∫•‡∫≤‡∫ß</span>
                        <span id="btn-swap" style="cursor:pointer; color: var(--primary);">üîÑ ‡∫õ‡ªà‡∫Ω‡∫ô</span>
                        <span id="label-to">Karaoke</span>
                    </div>
                    <textarea id="input-text" placeholder="‡∫û‡∫¥‡∫°‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°‡∫¢‡∫π‡ªà‡∫ó‡∫µ‡ªà‡∫ô‡∫µ‡ªâ..."></textarea>
                    <button id="btn-do-translate" class="btn btn-primary" style="margin-top: 10px;">‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤</button>
                </div>

                <div id="card-result" class="card hidden">
                    <p style="font-size: 12px; color: var(--text-secondary); margin: 0 0 10px 0;">‡∫ú‡∫ª‡∫ô‡∫•‡∫±‡∫ö:</p>
                    <div id="output-text" class="output-container"></div>
                    <button id="btn-copy" class="btn" style="background:#edf2f7; margin-top:10px;">‡∫Ñ‡∫±‡∫î‡∫•‡∫≠‡∫Å</button>
                </div>
            </div>

            <div id="tab-profile" class="tab-view hidden">
                <h2 style="margin-bottom: 20px;">‡ªÇ‡∫õ‡∫£‡ªÑ‡∫ü‡∫•‡ªå</h2>
                <div class="card" style="text-align: center;">
                    <img id="user-avatar" class="profile-img" src="" alt="User">
                    <h3 id="user-display-name" style="margin: 5px 0;">...</h3>
                    <p id="user-email" style="font-size: 14px; color: var(--text-secondary); margin: 0 0 15px 0;">...</p>
                    <div id="premium-badge-container"></div>
                    
                    <div style="text-align: left; margin-top: 25px; background: #f8fafc; padding: 15px; border-radius: 12px;">
                        <p style="margin: 0; font-size: 14px;">üìä ‡ªÇ‡∫Ñ‡∫ï‡ªâ‡∫≤‡∫Å‡∫≤‡∫ô‡ªÉ‡∫ä‡ªâ‡∫á‡∫≤‡∫ô‡∫°‡∫∑‡ªâ‡∫ô‡∫µ‡ªâ:</p>
                        <h4 id="usage-status" style="margin: 5px 0;">0 / 15 ‡∫Ñ‡∫±‡ªâ‡∫á</h4>
                    </div>

                    <button id="btn-go-premium" class="btn btn-primary" style="margin-top: 20px; background: var(--warning); color: black;">‚≠ê ‡∫≠‡∫±‡∫ö‡ªÄ‡∫Å‡∫£‡∫î Premium</button>
                    <button id="btn-logout" class="btn" style="margin-top: 15px; color: var(--danger);">‡∫≠‡∫≠‡∫Å‡∫à‡∫≤‡∫Å‡∫•‡∫∞‡∫ö‡∫ª‡∫ö</button>
                </div>
            </div>

            <div id="tab-upgrade" class="tab-view hidden">
                <div style="display:flex; align-items: center; margin-bottom: 20px;">
                    <button onclick="switchTab('tab-profile')" style="background:none; border:none; font-size: 20px; cursor:pointer;">‚¨ÖÔ∏è</button>
                    <h2 style="margin: 0 0 0 10px;">‡∫™‡∫∞‡ªù‡∫±‡∫Å Premium</h2>
                </div>
                <div class="card" style="text-align: center;">
                    <p style="font-weight: bold; font-size: 18px; margin-bottom: 5px;">‡∫•‡∫≤‡∫Ñ‡∫≤ 99,000 ‡∫Å‡∫µ‡∫ö</p>
                    <p style="color: var(--text-secondary); font-size: 14px; margin: 0;">‡ªÉ‡∫ä‡ªâ‡∫á‡∫≤‡∫ô‡∫ö‡ªç‡ªà‡∫à‡∫≥‡∫Å‡∫±‡∫î 3 ‡ªÄ‡∫î‡∫∑‡∫≠‡∫ô</p>
                    
                    <div class="qr-box">
                        <div style="font-size: 40px;">üè¶</div>
                        <p style="font-weight: bold; margin: 10px 0;">BCEL One QR</p>
                        <p style="font-size: 12px; color: var(--text-secondary);">‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡∫™‡∫∞‡ªÅ‡∫Å‡∫ô QR ‡ªÇ‡∫≠‡∫ô‡ªÄ‡∫á‡∫¥‡∫ô‡∫ú‡ªà‡∫≤‡∫ô BCEL One</p>
                    </div>

                    <div style="text-align: left; font-size: 14px; line-height: 1.6;">
                        <p><b>‡∫ß‡∫¥‡∫ó‡∫µ‡ªÄ‡∫õ‡∫µ‡∫î‡ªÉ‡∫ä‡ªâ‡∫á‡∫≤‡∫ô:</b></p>
                        <p>1. ‡ªÇ‡∫≠‡∫ô‡ªÄ‡∫á‡∫¥‡∫ô‡∫ï‡∫≤‡∫°‡∫•‡∫≤‡∫Ñ‡∫≤‡∫ó‡∫µ‡ªà‡∫Å‡∫≥‡∫ô‡∫ª‡∫î.</p>
                        <p>2. ‡ªÅ‡∫Ñ‡∫±‡∫ö‡ªú‡ªâ‡∫≤‡∫à‡ªç‡ªÉ‡∫ö‡∫ö‡∫¥‡∫ô‡∫Å‡∫≤‡∫ô‡ªÇ‡∫≠‡∫ô.</p>
                        <p>3. ‡∫™‡∫ª‡ªà‡∫á‡ªÉ‡∫ö‡∫ö‡∫¥‡∫ô‡∫°‡∫≤‡∫ó‡∫µ‡ªà WhatsApp ‡ªÅ‡∫≠‡∫±‡∫î‡∫°‡∫¥‡∫ô.</p>
                    </div>

                    <a href="https://wa.me/2029988148" target="_blank" class="btn btn-primary" style="background: #25D366; text-decoration: none; display: block; margin-top: 20px;">‡∫™‡∫ª‡ªà‡∫á‡ªÉ‡∫ö‡∫ö‡∫¥‡∫ô‡∫ó‡∫≤‡∫á WhatsApp</a>
                </div>
            </div>

        </div>

        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchTab('tab-translate')">
                <span>üåê</span>
                <small>‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤</small>
            </div>
            <div class="nav-item" onclick="switchTab('tab-profile')">
                <span>üë§</span>
                <small>‡ªÇ‡∫õ‡∫£‡ªÑ‡∫ü‡∫•‡ªå</small>
            </div>
        </div>
    </div>

    <script>
        // --- Firebase Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyAQDV_jzYvaAR7EzbUclP5ru-rMygMW44I",
            authDomain: "laokaraoke-43d77.firebaseapp.com",
            projectId: "laokaraoke-43d77",
            storageBucket: "laokaraoke-43d77.firebasestorage.app",
            messagingSenderId: "6060211155",
            appId: "1:6060211155:web:f5a63c55cf6e0ea9180d26"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- Dictionary & Logic ---
        const karaokeToLaoMap = { "sam": "‡∫ä‡ªç‡ªà‡∫≤", "bg": "‡ªÄ‡∫ö‡∫µ‡∫á", "happy birthday": "‡∫™‡∫∏‡∫Å‡∫™‡∫±‡∫ô‡∫ß‡∫±‡∫ô‡ªÄ‡∫Å‡∫µ‡∫î" }; // ‡∫™‡∫≤‡∫°‡∫≤‡∫î‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡∫à‡∫≤‡∫Å translator.ts
        const laoToKaraokeMap = { "‡∫ä‡ªç‡ªà‡∫≤": "sam", "‡ªÄ‡∫ö‡∫µ‡∫á": "bg", "‡∫™‡∫∏‡∫Å‡∫™‡∫±‡∫ô‡∫ß‡∫±‡∫ô‡ªÄ‡∫Å‡∫µ‡∫î": "happy birthday" };

        let currentDirection = "lao-to-karaoke";
        let userData = { usageCount: 0, isPremium: false };
        const FREE_LIMIT = 15;

        // --- Auth Observer ---
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                document.getElementById('page-login').classList.add('hidden');
                document.getElementById('app-content').classList.remove('hidden');
                updateProfileUI(user);
                await fetchUserData(user.uid);
            } else {
                document.getElementById('page-login').classList.remove('hidden');
                document.getElementById('app-content').classList.add('hidden');
            }
        });

        async function fetchUserData(uid) {
            const userRef = db.collection('users').doc(uid);
            const doc = await userRef.get();
            const today = new Date().toDateString();

            if (!doc.exists) {
                userData = { usageCount: 0, isPremium: false, lastReset: today };
                await userRef.set(userData);
            } else {
                userData = doc.data();
                if (userData.lastReset !== today && !userData.isPremium) {
                    userData.usageCount = 0;
                    userData.lastReset = today;
                    await userRef.update({ usageCount: 0, lastReset: today });
                }
            }
            refreshStats();
        }

        function updateProfileUI(user) {
            document.getElementById('user-avatar').src = user.photoURL || 'https://via.placeholder.com/100';
            document.getElementById('user-display-name').textContent = user.displayName;
            document.getElementById('user-email').textContent = user.email;
        }

        function refreshStats() {
            const statusText = userData.isPremium ? "Premium: ‡∫ö‡ªç‡ªà‡∫à‡∫≥‡∫Å‡∫±‡∫î" : `${userData.usageCount} / ${FREE_LIMIT} ‡∫Ñ‡∫±‡ªâ‡∫á`;
            document.getElementById('usage-status').textContent = statusText;
            document.getElementById('premium-badge-container').innerHTML = userData.isPremium ? '<span class="premium-tag">‚≠ê PREMIUM</span>' : '';
            document.getElementById('btn-go-premium').classList.toggle('hidden', userData.isPremium);
        }

        // --- App Actions ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-view').forEach(t => t.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if (tabId === 'tab-translate') document.querySelectorAll('.nav-item')[0].classList.add('active');
            if (tabId === 'tab-profile') document.querySelectorAll('.nav-item')[1].classList.add('active');
        }

        document.getElementById('btn-swap').onclick = () => {
            currentDirection = currentDirection === "lao-to-karaoke" ? "karaoke-to-lao" : "lao-to-karaoke";
            document.getElementById('label-from').textContent = currentDirection === "lao-to-karaoke" ? "‡∫•‡∫≤‡∫ß" : "Karaoke";
            document.getElementById('label-to').textContent = currentDirection === "lao-to-karaoke" ? "Karaoke" : "‡∫•‡∫≤‡∫ß";
        };

        document.getElementById('btn-do-translate').onclick = async () => {
            if (!userData.isPremium && userData.usageCount >= FREE_LIMIT) {
                alert("‡ªÇ‡∫Ñ‡∫ï‡ªâ‡∫≤‡∫Ç‡∫≠‡∫á‡∫ó‡ªà‡∫≤‡∫ô‡ªù‡∫ª‡∫î‡ªÅ‡∫•‡ªâ‡∫ß! ‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡∫≠‡∫±‡∫ö‡ªÄ‡∫Å‡∫£‡∫î Premium");
                switchTab('tab-upgrade');
                return;
            }

            const text = document.getElementById('input-text').value.trim();
            if (!text) return;

            // Simple Translation Logic
            let result = text;
            const map = currentDirection === "lao-to-karaoke" ? laoToKaraokeMap : karaokeToLaoMap;
            for (let key in map) {
                result = result.replace(new RegExp(key, 'g'), map[key]);
            }

            document.getElementById('output-text').textContent = result;
            document.getElementById('card-result').classList.remove('hidden');

            if (!userData.isPremium) {
                userData.usageCount++;
                refreshStats();
                await db.collection('users').doc(auth.currentUser.uid).update({ usageCount: userData.usageCount });
            }
        };

        document.getElementById('btn-login-google').onclick = () => auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
        document.getElementById('btn-logout').onclick = () => auth.signOut();
        document.getElementById('btn-go-premium').onclick = () => switchTab('tab-upgrade');
        document.getElementById('btn-copy').onclick = () => {
            navigator.clipboard.writeText(document.getElementById('output-text').textContent);
            alert("‡∫Ñ‡∫±‡∫î‡∫•‡∫≠‡∫Å‡ªÅ‡∫•‡ªâ‡∫ß!");
        };
    </script>
</body>
</html>
