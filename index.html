<!DOCTYPE html>
<html lang="lo">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lao Karaoke - ‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤‡ªÇ‡∫≠‡ªÄ‡∫Å‡∫∞</title>
  
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <style>
    :root {
      --primary-color: #2c5282;
      --primary-light: #4299e1;
      --secondary-color: #38a169;
      --light-bg: #f7fafc;
      --border-color: #e2e8f0;
      --text-color: #2d3748;
      --white: #ffffff;
    }

    body {
      font-family: 'Saysettha OT', 'Noto Sans Lao', sans-serif;
      background-color: var(--light-bg);
      color: var(--text-color);
      margin: 0;
      line-height: 1.6;
    }

    /* Auth Overlay */
    .auth-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85); display: flex; justify-content: center;
      align-items: center; z-index: 2000;
    }
    .auth-box {
      background: white; padding: 30px; border-radius: 12px; 
      text-align: center; max-width: 350px; width: 90%;
    }

    /* User Bar */
    .user-bar {
      background: white; padding: 10px 20px; border-bottom: 1px solid var(--border-color);
      display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem;
    }

    .container {
      max-width: 800px; margin: 0 auto; padding: 20px;
    }

    .main-header { text-align: center; margin-bottom: 30px; }
    
    textarea {
      width: 100%; height: 150px; padding: 15px; border: 1px solid var(--border-color);
      border-radius: 8px; font-size: 1rem; margin-bottom: 15px; box-sizing: border-box;
    }

    .direction-select {
      width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 8px; border: 1px solid var(--border-color);
    }

    .button-group { display: flex; gap: 10px; margin-bottom: 20px; }
    
    .btn {
      flex: 1; padding: 12px; border: none; border-radius: 8px;
      font-weight: bold; cursor: pointer; transition: 0.2s;
    }
    .btn-primary { background: var(--primary-color); color: white; }
    .btn-secondary { background: #edf2f7; color: #4a5568; }
    .btn-success { background: var(--secondary-color); color: white; }

    .output-container {
      min-height: 120px; padding: 15px; background: white; border: 1px solid var(--border-color);
      border-radius: 8px; margin-bottom: 15px; white-space: pre-wrap;
    }

    .premium-box {
      border: 2px solid #ecc94b; background: #fffff0; padding: 20px; border-radius: 10px; text-align: center;
    }

    .badge-premium { background: #ecc94b; color: black; padding: 2px 8px; border-radius: 5px; font-weight: bold; }
    .hidden { display: none !important; }
    
    #loading { text-align: center; color: var(--primary-color); display: none; margin-bottom: 10px; }
  </style>
</head>
<body>

  <div id="authOverlay" class="auth-overlay">
    <div class="auth-box">
      <h2>‡∫ç‡∫¥‡∫ô‡∫î‡∫µ‡∫ï‡ªâ‡∫≠‡∫ô‡∫Æ‡∫±‡∫ö</h2>
      <p>‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫™‡∫π‡ªà‡∫•‡∫∞‡∫ö‡∫ª‡∫ö‡∫î‡ªâ‡∫ß‡∫ç Google ‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÉ‡∫ä‡ªâ‡∫á‡∫≤‡∫ô</p>
      <button id="googleLoginBtn" class="btn btn-primary">Login with Google</button>
    </div>
  </div>

  <div id="userBar" class="user-bar hidden">
    <div id="userName">Loading...</div>
    <div id="usageQuota">Quota: 0/15</div>
    <button id="logoutBtn" style="color:red; background:none; border:none; cursor:pointer;">Logout</button>
  </div>

  <div class="container">
    <div class="main-header">
      <h1>‡ªÅ‡∫õ‡∫•‡∫≤‡∫ß ‚Üî Karaoke</h1>
      <p>‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫á‡∫°‡∫∑‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤‡∫•‡∫≤‡∫ß‡ªÄ‡∫õ‡∫±‡∫ô‡∫û‡∫≤‡∫™‡∫≤ Karaoke</p>
    </div>

    <textarea id="inputText" placeholder="‡∫û‡∫¥‡∫°‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°‡∫ó‡∫µ‡ªà‡∫ô‡∫µ‡ªâ..."></textarea>

    <select id="direction" class="direction-select">
      <option value="lao-to-karaoke">‡∫•‡∫≤‡∫ß ‚ûú Karaoke</option>
      <option value="karaoke-to-lao">Karaoke ‚ûú ‡∫•‡∫≤‡∫ß</option>
    </select>

    <div class="button-group">
      <button id="translateBtn" class="btn btn-primary">‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤</button>
      <button id="clearBtn" class="btn btn-secondary">‡∫•‡ªâ‡∫≤‡∫á‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°</button>
    </div>

    <div id="loading">‡∫Å‡∫≥‡∫•‡∫±‡∫á‡∫õ‡∫∞‡∫°‡∫ß‡∫ô‡∫ú‡∫ª‡∫ô...</div>
    <div id="output" class="output-container"></div>
    
    <button id="copyBtn" class="btn btn-success hidden">‡∫Ñ‡∫±‡∫î‡∫•‡∫≠‡∫Å‡∫ú‡∫ª‡∫ô‡∫•‡∫±‡∫ö</button>

    <div id="premiumSection" class="premium-box" style="margin-top: 30px;">
      <h3 style="color: #b7791f;">‚≠ê ‡∫õ‡∫ª‡∫î‡∫•‡∫±‡∫≠‡∫Å Premium</h3>
      <p>‡ªÉ‡∫ä‡ªâ‡∫á‡∫≤‡∫ô‡∫ö‡ªç‡ªà‡∫à‡∫≥‡∫Å‡∫±‡∫î 3 ‡ªÄ‡∫î‡∫∑‡∫≠‡∫ô | ‡∫•‡∫≤‡∫Ñ‡∫≤‡∫û‡∫¥‡ªÄ‡∫™‡∫î</p>
      <p>‡∫ä‡∫≥‡∫•‡∫∞‡∫ú‡ªà‡∫≤‡∫ô BCEL One (P2P) ‡ªÅ‡∫•‡ªâ‡∫ß‡∫™‡∫ª‡ªà‡∫á‡ªÉ‡∫ö‡∫ö‡∫¥‡∫ô‡∫°‡∫≤‡∫ó‡∫≤‡∫á WhatsApp</p>
      <a href="https://wa.me/2029988148" target="_blank" class="btn btn-success" style="text-decoration: none; display: inline-block; background: #ecc94b; color: black;">
        ‡∫™‡∫∞‡ªù‡∫±‡∫Å Premium ‡∫ó‡∫µ‡ªà‡∫ô‡∫µ‡ªâ
      </a>
    </div>

    <footer style="text-align: center; margin-top: 50px; color: #718096; font-size: 0.8rem;">
      <p>¬© 2025-2026 Lao Karaoke - ‡∫û‡∫±‡∫î‡∫ó‡∫∞‡∫ô‡∫≤‡ªÇ‡∫î‡∫ç: ‡∫à‡∫±‡∫ô‡∫ó‡∫∞‡∫à‡∫≠‡∫ô ‡∫û‡∫¥‡∫°‡∫°‡∫∞‡∫™‡∫≠‡∫ô</p>
    </footer>
  </div>

  <script>
    // --- 1. Firebase Configuration ---
    const firebaseConfig = {
      apiKey: "AIzaSyAQDV_jzYvaAR7EzbUclP5ru-rMygMW44I",
      authDomain: "laokaraoke-43d77.firebaseapp.com",
      projectId: "laokaraoke-43d77",
      storageBucket: "laokaraoke-43d77.firebasestorage.app",
      messagingSenderId: "6060211155",
      appId: "1:6060211155:web:f5a63c55cf6e0ea9180d26",
      measurementId: "G-RYHD1BZ16B"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;
    let userData = { usageCount: 0, isPremium: false };

    // --- 2. Karaoke Logic Dictionary ---
    const dictionary = {
      "‡∫ä‡ªç‡ªà‡∫≤": "sam", "‡ªÄ‡∫ö‡∫µ‡∫á": "bg", "‡ªÄ‡∫ö‡∫µ‡ªà‡∫á": "bg", "‡ªÄ‡∫ö‡∫¥‡∫á": "bg",
      "‡∫™‡∫∏‡∫Å‡∫™‡∫±‡∫ô‡∫ß‡∫±‡∫ô‡ªÄ‡∫Å‡∫µ‡∫î": "happy birthday", "‡ªù‡∫≤": "Marüê∂", "‡∫´‡∫°‡∫≤": "Marüê∂",
      "‡ªÅ‡∫¢‡ªâ": "yae", "‡ªÅ‡∫¢‡ªà": "yae", "‡ªÉ‡∫™‡ªà": "yae", "k": "‡ªÄ‡∫Ñ", "m": "‡ªÇ‡∫°‡∫á"
    };

    // --- 3. Authentication Logic ---
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        currentUser = user;
        document.getElementById('authOverlay').classList.add('hidden');
        document.getElementById('userBar').classList.remove('hidden');
        document.getElementById('userName').textContent = user.displayName;
        await syncUserDoc(user.uid);
      } else {
        document.getElementById('authOverlay').classList.remove('hidden');
        document.getElementById('userBar').classList.add('hidden');
      }
    });

    async function syncUserDoc(uid) {
      const userRef = db.collection('users').doc(uid);
      const doc = await userRef.get();
      const today = new Date().toDateString();

      if (!doc.exists) {
        userData = { usageCount: 0, isPremium: false, lastReset: today };
        await userRef.set(userData);
      } else {
        userData = doc.data();
        if (userData.lastReset !== today && !userData.isPremium) {
          userData.usageCount = 0;
          userData.lastReset = today;
          await userRef.update({ usageCount: 0, lastReset: today });
        }
      }
      updateUI();
    }

    function updateUI() {
      const quotaLabel = document.getElementById('usageQuota');
      const premiumSec = document.getElementById('premiumSection');
      if (userData.isPremium) {
        quotaLabel.innerHTML = "<span class='badge-premium'>‚≠ê Premium</span> ‡∫ö‡ªç‡ªà‡∫à‡∫≥‡∫Å‡∫±‡∫î";
        premiumSec.classList.add('hidden');
      } else {
        quotaLabel.textContent = `‡ªÇ‡∫Ñ‡∫ï‡ªâ‡∫≤: ${userData.usageCount}/15`;
        premiumSec.classList.remove('hidden');
      }
    }

    // --- 4. Translation Logic ---
    function translateLogic(text, mode) {
      if (mode === 'lao-to-karaoke') {
        let result = text;
        const keys = Object.keys(dictionary).sort((a,b) => b.length - a.length);
        keys.forEach(key => {
          const regex = new RegExp(key, 'g');
          result = result.replace(regex, dictionary[key] + " ");
        });
        return result.trim();
      } else {
        // Karaoke to Lao (Basic reverse)
        let result = text.toLowerCase();
        const keys = Object.keys(dictionary);
        keys.forEach(key => {
          const val = dictionary[key].toLowerCase();
          const regex = new RegExp(val, 'g');
          result = result.replace(regex, key);
        });
        return result;
      }
    }

    async function handleTranslate() {
      if (!userData.isPremium && userData.usageCount >= 15) {
        alert("‡∫ó‡ªà‡∫≤‡∫ô‡ªÉ‡∫ä‡ªâ‡∫Ñ‡∫ª‡∫ö‡ªÇ‡∫Ñ‡∫ï‡ªâ‡∫≤ 15 ‡∫Ñ‡∫±‡ªâ‡∫á‡∫™‡∫≥‡∫•‡∫±‡∫ö‡∫°‡∫∑‡ªâ‡∫ô‡∫µ‡ªâ‡ªÅ‡∫•‡ªâ‡∫ß! ‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡∫™‡∫∞‡ªù‡∫±‡∫Å Premium.");
        return;
      }

      const input = document.getElementById('inputText').value.trim();
      if (!input) return;

      document.getElementById('loading').style.display = 'block';
      
      setTimeout(async () => {
        const mode = document.getElementById('direction').value;
        const result = translateLogic(input, mode);
        
        document.getElementById('output').textContent = result;
        document.getElementById('loading').style.display = 'none';
        document.getElementById('copyBtn').classList.remove('hidden');

        if (!userData.isPremium) {
          userData.usageCount++;
          updateUI();
          await db.collection('users').doc(currentUser.uid).update({
            usageCount: userData.usageCount
          });
        }
      }, 500);
    }

    // --- 5. Event Listeners ---
    document.getElementById('googleLoginBtn').onclick = () => {
      auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
    };

    document.getElementById('logoutBtn').onclick = () => auth.signOut();

    document.getElementById('translateBtn').onclick = handleTranslate;

    document.getElementById('clearBtn').onclick = () => {
      document.getElementById('inputText').value = '';
      document.getElementById('output').textContent = '';
      document.getElementById('copyBtn').classList.add('hidden');
    };

    document.getElementById('copyBtn').onclick = () => {
      const text = document.getElementById('output').textContent;
      navigator.clipboard.writeText(text).then(() => alert("‡∫Ñ‡∫±‡∫î‡∫•‡∫≠‡∫Å‡ªÅ‡∫•‡ªâ‡∫ß!"));
    };
  </script>
</body>
</html>
